# Архитектура клиентского приложения "Trip Scheduler"

## Введение

Данный документ описывает архитектуру клиентского приложения "Trip Scheduler". В основе лежит подход, который вы охарактеризовали как **VSA (Vertical Slice Architecture) с одним потоком**. Этот выбор отражает современные практики построения масштабируемых и поддерживаемых фронтенд-приложений.

Ключевая идея этой архитектуры — **организация кодовой базы вокруг функциональных блоков (фич или "слайсов"), а не по техническим типам файлов (компоненты, сервисы, стили)**. "Один поток" в данном контексте интерпретируется как **строгий однонаправленный поток зависимостей** между слоями, что предотвращает циклические зависимости и делает архитектуру предсказуемой.

## Ключевые принципы

1.  **Слоевая структура (Layered Architecture)**: Код разделен на слои с четко определенной зоной ответственности.
2.  **Вертикальные слайсы (Vertical Slices)**: Функциональность группируется в "слайсы", которые пронизывают все слои. Это обеспечивает высокую связность внутри фичи и низкую связанность между разными фичами.
3.  **Однонаправленный поток зависимостей (One-Way Dependency Flow)**: Компоненты на более высоком уровне иерархии могут зависеть только от компонентов на более низких уровнях. Эта зависимость строго контролируется нумерацией папок в директории `components`.

## Структура проекта

### Директория `components` — Ядро архитектуры

Это основная директория, где реализована слоевая модель. Каждый слой имеет числовой префикс, который определяет его место в иерархии и правила импорта.

#### `01.kit` — UI Kit

- **Назначение**: Самый низкий уровень абстракции. Содержит атомарные, переиспользуемые UI-компоненты, которые ничего не знают о бизнес-логике.
- **Примеры**: `kit-btn` (кнопка), `kit-input` (поле ввода), `kit-avatar` (аватар), `kit-calendar` (календарь).
- **Правило**: Компоненты этого слоя не могут импортировать что-либо из других слоев (`02` и выше).

#### `02.shared` — Общие компоненты (Виджеты)

- **Назначение**: Содержит более сложные, но все еще универсальные компоненты, которые могут быть использованы в разных частях приложения. Они могут состоять из нескольких компонентов `01.kit`.
- **Примеры**: `app-header`, `app-footer`, `theme-manager`, `profile-drawer`.
- **Правило**: Может использовать только компоненты из `01.kit`.

#### `03.domain` — Доменные сущности

- **Назначение**: Описывает бизнес-сущности и их логику. В вашем проекте здесь находится сложный компонент `plan-geolocation-section`, который инкапсулирует всю логику, связанную с картами и геолокацией в контексте плана путешествия.
- **Примеры**: `plan-geolocation-section` со своими `composables`, моделями и UI.
- **Правило**: Может использовать `01.kit` и `02.shared`.

#### `04.features` — Функциональные блоки (Фичи)

- **Назначение**: Реализует конкретные пользовательские сценарии (фичи). Каждая фича — это независимый модуль, который решает одну бизнес-задачу. Это реализация "вертикального слайса".
- **Примеры**: `trip-comments` (комментарии к путешествию), `trip-memories` (воспоминания), `trip-plan` (план путешествия), `finances-section` (секция финансов). Каждая фича содержит свой `store` для управления состоянием, `ui` компоненты и `models`.
- **Правило**: Может использовать `01.kit`, `02.shared`, `03.domain`. Фичи не должны зависеть друг от друга напрямую.

#### `05.modules` — Модули приложения (Процессы/Страницы)

- **Назначение**: Крупные, композиционные блоки, которые объединяют несколько фич и сущностей для формирования полноценных частей интерфейса, например, целых страниц.
- **Примеры**: `trips-hub` (список всех путешествий), `trip-info` (детальная страница путешествия), `account` (модули управления аккаунтом).
- **Правило**: Может использовать все нижележащие слои (`01` - `04`).

#### `06.layouts` — Слои представления

- **Назначение**: Определяет общую структуру страниц приложения (шаблоны).
- **Примеры**: `default` (стандартный шаблон с хедером и футером), `empty` (пустой шаблон для страниц авторизации), `trip-info` (специализированный шаблон для страницы путешествия).
- **Правило**: Может использовать все нижележащие слои для построения своей структуры.

### Другие директории

- **`assets`**: Глобальные стили, миксины, переменные и темы (светлая/темная).
- **`pages`**: Роутинг. Файлы в этой директории напрямую соответствуют страницам приложения. Они служат точкой входа и, как правило, просто импортируют и отображают соответствующий компонент из слоя `05.modules`.
- **`plugins`**: Плагины Vue для инициализации общеприлокационной логики (запросы к API, восстановление сессии, управление темой).
- **`service-worker`**: Логика для PWA (Progressive Web Application), включая кеширование и работу в оффлайн-режиме.
- **`shared`**: Глобально переиспользуемый код, который не является компонентами. Сюда входят:
  - **`composables`**: Общие Vue Composables.
  - **`constants`**: Константы, такие как маршруты и списки иконок.
  - **`services`**: Сервисы для взаимодействия с внешним миром, в частности, `database`, который абстрагирует работу с API (TRPC, SQL, Mock).
  - **`store`**: Глобальные хранилища Pinia (аутентификация, тема и т.д.).
  - **`types`**: Глобальные типы и модели данных.

## Поток данных и управление состоянием

1.  **Взаимодействие с API**: Слой `shared/services/database` предоставляет абстракцию для работы с данными. Он имеет несколько реализаций (`trpc`, `sql`, `mock`), что делает приложение гибким и тестируемым.
2.  **Управление состоянием**: Используется Pinia. Состояние разделено на две категории:
    - **Глобальное состояние** (`shared/store`): хранит данные, необходимые всему приложению (например, `auth.store`, `theme.store`).
    - **Состояние фичи** (`components/04.features/.../store`): каждая фича имеет собственное хранилище (`trip-comments.store`, `trip-memories.store`), что обеспечивает ее независимость и инкапсуляцию.
3.  **Отображение**: Компоненты из слоев `04.features` и `05.modules` подписываются на изменения в соответствующих хранилищах и отображают данные. Пользовательские действия вызывают экшены в хранилищах, которые, в свою очередь, могут инициировать запросы к API.

## Заключение

Выбранная архитектура является зрелой и хорошо продуманной реализацией **Vertical Slice Architecture**, адаптированной для фронтенда.

**Сильные стороны**:

- **Масштабируемость**: Легко добавлять новые фичи, не затрагивая существующие.
- **Поддерживаемость**: Четкая структура и строгие правила зависимостей упрощают навигацию по коду и его рефакторинг.
- **Низкая связанность (Low Coupling)**: Фичи изолированы друг от друга, что снижает риск каскадных изменений.
- **Высокая связность (High Cohesion)**: Весь код, относящийся к одной фиче, находится в одном месте.
- **Параллельная разработка**: Разные разработчики могут работать над разными слайсами одновременно, не мешая друг другу.
